<html>

<head>
    <title>令和6年能登半島地震 空中写真の被災前後比較マップ</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.11.0/dist/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.2/proj4.js"></script>
    <link href="maplibre-gl-compare.css" rel="stylesheet" />
    <script src="maplibre-gl-compare.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        #info-before {
            padding: 6px 8px;
            font: 12px/14px Arial, Helvetica, sans-serif;
            color: navy;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            width: fit-content;
            position: absolute;
            top: 10px;
            left: 45px;
            z-index: 1;
        }

        .yubi-before {
            cursor: pointer;
            z-index: 1;
        }

        #info-after {
            padding: 6px 8px;
            font: 12px/14px Arial, Helvetica, sans-serif;
            color: navy;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            width: fit-content;
            position: absolute;
            top: 10px;
            right: 45px;
            z-index: 1;
        }

        .yubi-after {
            cursor: pointer;
            z-index: 1;
        }

        .checkbox-button-container {
            display: flex;
            flex-direction: column;
            justify-content: start;
        }

        .column {
            display: flex;
            flex-direction: column;
            margin-right: 20px;
        }

        .legend {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font: 12px/14px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            padding: 10px;
            position: absolute;
            bottom: 40px;
            right: 5px;
            z-index: 1;
            line-height: 10px;
            height: auto;
        }

        .legend h4 {
            margin: 0 0 10px;
        }

        .legend div span {
            border-radius: 50%;
            display: inline-block;
            height: 15px;
            margin-right: 10px;
            width: 15px;
            color: orangered;
        }

        .legend .square {
            width: 10px;
            height: 10px;
        }

        .legend-pop {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font: 12px/14px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            padding: 10px;
            position: absolute;
            bottom: 180px;
            right: 5px;
            z-index: 1;
            line-height: 20px;
            height: auto;
        }

        .legend-pop h4 {
            margin: 0 0 10px;
        }

        .legend-pop div span {
            border-radius: 50%;
            display: inline-block;
            height: 15px;
            margin-right: 10px;
            width: 15px;
            color: orangered;
        }

        .legend-pop .square {
            width: 15px;
            height: 15px;
        }

        .legend-road {
            position: absolute;
            top: 185px;
            right: 10px;
            z-index: 1;
            background: white;
            padding: 5px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            width: fit-content;
        }

        .image-container {
            display: flex;
            justify-content: center;
        }

        .legend-road img {
            width: 444px;
            height: 240px;
        }
    </style>
</head>

<body>
    <style>
        body {
            overflow: hidden;
        }

        body * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .map-overlay {
            font: bold 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            position: absolute;
            width: 160px;
            bottom: 20px;
            left: 5px;
            padding: 10px;
        }

        .map-overlay .map-overlay-inner {
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .map-overlay label {
            display: block;
            margin: 0 0 0px;
            font-size: 12px;
            top: 100px;
            left: 10px;
            display: block;
            margin-bottom: 5px;
        }

        .map-overlay input {
            background-color: transparent;
            display: inline-block;
            width: 100%;
            position: relative;
            margin: 0;
            cursor: ew-resize;
        }

        /*100mメッシュ人口*/
        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content {
            padding: 8px 10px;
            font: 12px/14px Arial, Helvetica, sans-serif;
            color: black;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.9);
            border-radius: 5px;
            width: 280px;
            height: 220px;
            /*overflow: scroll;*/
        }

        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .shinouchimei-title {
            color: red;
            font-size: larger;
        }

        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .pop-info th {
            width: 100px;
        }

        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .pop-info td:nth-child(1) {
            text-align: right;
            width: 100px;
            white-space: nowrap;
        }

        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .pop-info td:nth-child(2) {
            text-align: left;
            width: 150px;
            white-space: nowrap;
        }

        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .pop-info b {
            text-align: right;
        }

        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .pop-info,
        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .pop-info th,
        .custom-100m-mesh-pop2020-popup .maplibregl-popup-content .pop-info td {
            font: 12px/14px Arial, Helvetica, sans-serif;
        }

        /*孤立集落人数*/
        .custom-Number-of-isolated-area-popup .maplibregl-popup-content {
            padding: 8px 10px;
            font: 12px/14px Arial, Helvetica, sans-serif;
            color: black;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.9);
            border-radius: 5px;
            width: 250px;
            height: 300px;
            overflow: scroll;
        }

        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .shinouchimei-title {
            color: red;
            font-size: larger;
        }

        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .pop-info th {
            width: 100px;
        }

        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .pop-info td:nth-child(1) {
            text-align: right;
            width: 100px;
            white-space: nowrap;
        }

        /* 2列目 (右側) のセルの幅を広げる */
        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .pop-info td:nth-child(2) {
            text-align: left;
            width: 150px;
            white-space: nowrap;
        }

        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .pop-info b {
            text-align: right;
        }

        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .pop-info,
        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .pop-info th,
        .custom-Number-of-isolated-area-popup .maplibregl-popup-content .pop-info td {
            font: 12px/14px Arial, Helvetica, sans-serif;
        }

        /*七尾市避難所開設情報*/
        .custom-open-shelter-Nanao-popup .maplibregl-popup-content {
            padding: 8px 10px;
            font: 12px/14px Arial, Helvetica, sans-serif;
            color: black;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.9);
            border-radius: 5px;
            width: 300px;
            height: 250px;
            overflow: scroll;
        }

        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .shinouchimei-title {
            color: red;
            font-size: larger;
        }

        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .pop-info th {
            width: 100px;
        }

        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .pop-info td:nth-child(1) {
            text-align: right;
            width: 100px;
            white-space: nowrap;
        }

        /* 2列目 (右側) のセルの幅を広げる */
        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .pop-info td:nth-child(2) {
            text-align: left;
            width: 150px;
            white-space: nowrap;
        }

        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .pop-info b {
            text-align: right;
        }

        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .pop-info,
        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .pop-info th,
        .custom-open-shelter-Nanao-popup .maplibregl-popup-content .pop-info td {
            font: 12px/14px Arial, Helvetica, sans-serif;
        }

        /*啓開前・啓開後比較箇所*/
        .custom-before-after-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 250px;
            height: 450px;
            /*overflow-y: auto;*/
        }

        .custom-before-after-popup .maplibregl-popup-content .popup-image {
            max-width: 100%;
            max-height: 180px;
            /*height: auto;*/
        }

        /*啓開作業状況*/
        .custom-sagyou-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 250px;
            height: 280px;
            overflow-y: auto;
        }

        .custom-sagyou-popup img {
            max-width: 100%;
            max-height: 180px;
            /*width: 100%;*/
            /*height: auto;*/
            /*object-fit: cover;*/
            /*margin-bottom: 10px;*/
        }

        .custom-sagyou-popup iframe {
            width: 100%;
            height: auto;
        }

        /*主な被災箇所*/
        .custom-damaged-area-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 270px;
            height: 120px;
            overflow-y: auto;
        }

        /*被災状況（空撮）*/
        .custom-damage-situation-aerial-photography-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 250px;
            height: 250px;
            overflow-y: auto;
        }

        .custom-damage-situation-aerial-photography-popup .maplibregl-popup-content .popup-image {
            max-width: 100%;
            max-height: 180px;
            height: auto;
        }

        /*復旧到達地点*/
        .custom-recovery-point-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 280px;
            height: 70px;
            overflow-y: auto;
        }

        /*緊急復旧済み区間*/
        /*
        .custom-emergency-restored-section-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 300px;
            height: 90px;
            overflow-y: auto;
        }
        */

        /*支援拠点の道の駅*/
        .custom-michinoeki-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 250px;
            height: 280px;
            overflow-y: auto;
        }

        .custom-michinoeki-popup .maplibregl-popup-content .popup-image {
            max-width: 100%;
            max-height: 180px;
            /*height: auto;*/
        }

        /*市町道路の状況把握結果*/
        .custom-municipal-road-investigation-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 280px;
            height: 120px;
            overflow-y: auto;
        }

        /*被災状況（360度画像/三次元点群データ）*/
        .custom-spherical-image-popup .maplibregl-popup-content {
            padding: 12px 15px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            width: 300px;
            height: 80px;
            overflow-y: auto;
        }
    </style>
    <div id="comparison-container">
        <div id="before" class="map"></div>
        <div id="after" class="map"></div>
    </div>
    <div id="info-before">
        <details>
            <summary class="yubi-before">
                <strong>空中写真(発災前)</strong>
            </summary>
            <fieldset>
                <div class="checkbox-button-container">
                    <div class="column">
                        <div>
                            <input type="checkbox" id="2020_2022" value="2020_2022" checked />
                            <label for="2020_2022">空中写真(2020年・2022年)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="201004_05" value="201004_05" />
                            <label for="201004_05">空中写真(2010年4月～5月頃)</label>
                        </div>
                    </div>
                </div>
            </fieldset>
        </details>
    </div>
    <div id="info-after">
        <details>
            <summary class="yubi-after">
                <strong>空中写真(発災後)等</strong>
            </summary>
            <fieldset>
                <div class="checkbox-button-container">
                    <div class="column">
                        <div>
                            <input type="checkbox" id="20240405-20240426" value="20240405-20240426" checked />
                            <label for="20240405-20240426">空中写真(2024年04月05日～04月26日撮影)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="20240102-20240117" value="20240102-20240117" />
                            <label for="20240102-20240117">空中写真(2024年01月02日～01月17日撮影)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="20240102" value="20240102" />
                            <label for="20240102">空中写真(2024年01月02日撮影)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="20240105" value="20240105" />
                            <label for="20240105">空中写真(2024年01月05日撮影)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="20240111" value="20240111" />
                            <label for="20240111">空中写真(2024年01月11日撮影)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="20240114" value="20240114" />
                            <label for="20240114">空中写真(2024年01月14日撮影)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="20240117" value="20240117" />
                            <label for="20240117">空中写真(2024年01月17日撮影)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="hokai" value="hokai" checked />
                            <label for="hokai">斜面崩壊・堆積範囲(1月22日更新)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="tsunami" value="tsunami" checked />
                            <label for="tsunami">津波浸水範囲(1月19日更新)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="Uplift" value="Uplift" checked />
                            <label for="Uplift">海岸線が前進した範囲(1月15日公開)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="fire" value="fire" checked />
                            <label for="fire">輪島市中心の火災焼失範囲(1月12日更新)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="uplift-port" value="uplift-port" checked />
                            <label for="uplift-port">陸化したと思われる港(1月18日更新)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="cracks" value="cracks" checked />
                            <label for="cracks">亀裂箇所(2月14日公表)</label>
                        </div>
                        <div>
                            <input type="checkbox" id="road-map" value="road-map" />
                            <label for="road-map">国交省 道路復旧見える化マップ</label>
                            <label id="open-legend-road" style="text-decoration: underline; cursor: pointer">凡例</label>
                        </div>
                        <div>
                            <input type="checkbox" id="pop-map" value="pop-map" />
                            <label for="pop-map">令和2年100mﾒｯｼｭ人口(石川県・富山県)</label>
                            <label id="open-legend-pop" style="text-decoration: underline; cursor: pointer">凡例</label>
                        </div>
                        <div>
                            <input type="checkbox" id="isolated-map" value="isolated-map" />
                            <label for="isolated-map">石川県孤立集落人数</label>
                        </div>
                        <div>
                            <input type="checkbox" id="shelter-nanao-map" value="shelter-nanao-map" />
                            <label for="shelter-nanao-map">石川県七尾市避難所開設情報</label>
                        </div>
                    </div>
                </div>
            </fieldset>
        </details>
    </div>
    <div class="map-overlay top">
        <div class="map-overlay-inner">
            <label>空中写真 不透明度: <span id="photo-slider-opacity-value">100%</span></label>
            <input id="photo-slider-opacity" type="range" min="0" max="100" step="1" value="100" />
        </div>
    </div>
    <div id="legend" class="legend">
        <h4>凡例</h4>
        <div class="square"
            style="background-color: rgb(255, 0, 0, 0.1); outline: 2px solid; outline-color: rgba(255, 0, 0, 1); display: inline-block">
        </div>
        <span style="margin-left: 5px">斜面崩壊・堆積範囲</span><br />
        <div style="height: 5px"></div>
        <div class="square"
            style="background-color: rgb(0, 0, 255, 0.1); outline: 2px solid; outline-color: rgba(0, 0, 255, 1); display: inline-block">
        </div>
        <span style="margin-left: 5px">津波浸水範囲</span>
        <div style="height: 5px"></div>
        <div class="square"
            style="background-color: rgb(191, 0, 255, 0.1); outline: 2px solid; outline-color: rgba(191, 0, 255, 1); display: inline-block">
        </div>
        <span style="margin-left: 5px">海岸線が前進した範囲</span>
        <div style="height: 5px"></div>
        <div class="square"
            style="background-color: rgb(255, 127, 0, 0.1); outline: 2px solid; outline-color: rgba(255, 127, 0, 1); display: inline-block">
        </div>
        <span style="margin-left: 5px">火災焼失範囲(輪島市中心)</span>
        <div style="height: 5px"></div>
        <div style="height: 3px; width: 12px; background-color: rgba(255, 0, 191, 1); display: inline-block"></div>
        <span style="margin-left: 5px">亀裂箇所</span>
        <div style="height: 5px"></div>
        <span><img src="https://maps.gsi.go.jp/portal/sys/v4/symbols/080.png"
                style="width: 15px; height: 15px" /></span>
        <span>陸化したと思われる港</span>
    </div>
    <div id="legend-pop" style="display: none" class="legend-pop">
        <h4>人口(100mﾒｯｼｭ)</h4>
        <div class="square" style="background-color: #0000ff; display: inline-block"></div>
        <span style="display: inline-block; margin-left: 5px">～10人未満</span><br />
        <div class="square" style="background-color: #00ffff; display: inline-block"></div>
        <span style="display: inline-block; margin-left: 5px">10～20人未満</span><br />
        <div class="square" style="background-color: #00ff00; display: inline-block"></div>
        <span style="display: inline-block; margin-left: 5px">20～40人未満</span><br />
        <div class="square" style="background-color: #ffbf00; display: inline-block"></div>
        <span style="display: inline-block; margin-left: 5px">40～60人未満</span><br />
        <div class="square" style="background-color: #ff0000; display: inline-block"></div>
        <span style="display: inline-block; margin-left: 5px">60～80人未満</span><br />
        <div class="square" style="background-color: #cb00cb; display: inline-block"></div>
        <span style="display: inline-block; margin-left: 5px">80人以上</span><br />
    </div>
    <script type="module">
        // Terrain-RGB形式への変換モジュール
        maplibregl.addProtocol('numpng', makeNumPngProtocol());
        import { makeNumPngProtocol } from './numPngProtocol.js';

        // addProtocolの設定
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol('pmtiles', protocol.tile);

        // マップを初期化
        const beforeMap = new maplibregl.Map({
            container: 'before',
            style: 'std_b.json',
            zoom: 9.8,
            center: [137.0178, 37.2459],
            pitch: 0,
            bearing: 0,
            maxPitch: 85,
            attributionControl: false,
            hash: true,
        });

        // マップをロード
        beforeMap.on('load', () => {
            // 産総研 シームレス標高タイルソース
            beforeMap.addSource('aist-dem', {
                type: 'raster-dem',
                tiles: ['numpng://tiles.gsj.jp/tiles/elev/mixed/{z}/{y}/{x}.png'],
                attribution: '<a href="https://tiles.gsj.jp/tiles/elev/tiles.html" target="_blank">産業技術総合研究所 シームレス標高タイル(統合DEM)</a>',
                tileSize: 256,
            });

            // 産総研 シームレス標高タイルセット
            // beforeMap.setTerrain({ 'source': 'aist-dem', 'exaggeration': 1 });
        });

        // ズーム・回転
        beforeMap.addControl(new maplibregl.NavigationControl(), 'top-left');

        // 現在位置表示
        beforeMap.addControl(
            new maplibregl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: false,
                },
                fitBoundsOptions: { maxZoom: 18 },
                trackUserLocation: true,
                showUserLocation: true,
            }),
            'top-left'
        );

        // 3D地形コントロール
        beforeMap.addControl(
            new maplibregl.TerrainControl({
                source: 'aist-dem',
                exaggeration: 1, // 標高を強調する倍率
            }),
            'top-left'
        );

        // スケール表示
        beforeMap.addControl(
            new maplibregl.ScaleControl({
                maxWidth: 150,
                unit: 'metric',
            })
        );

        // Attributionを折りたたみ表示
        beforeMap.addControl(
            new maplibregl.AttributionControl({
                compact: true,
                customAttribution: '<a href="https://twitter.com/shi__works" target="_blank">X(旧Twitter)</a> | <a href="https://github.com/shiwaku/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre" target="_blank">Github</a>',
            })
        );

        // マップを初期化
        const afterMap = new maplibregl.Map({
            container: 'after',
            style: 'std_a.json',
            // style: 'https://tile.openstreetmap.jp/styles/maptiler-basic-ja/style.json',
            zoom: 9.8,
            center: [137.0178, 37.2459],
            pitch: 0,
            bearing: 0,
            maxPitch: 85,
            attributionControl: false,
            hash: true,
        });

        // ズーム・回転
        afterMap.addControl(new maplibregl.NavigationControl(), 'top-right');

        // 現在位置表示
        afterMap.addControl(
            new maplibregl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: false,
                },
                fitBoundsOptions: { maxZoom: 18 },
                trackUserLocation: true,
                showUserLocation: true,
            }),
            'top-right'
        );

        // 3D地形コントロール
        afterMap.addControl(
            new maplibregl.TerrainControl({
                source: 'aist-dem',
                exaggeration: 1, // 標高を強調する倍率
            }),
            'top-right'
        );

        // Attributionを折りたたみ表示
        afterMap.addControl(
            new maplibregl.AttributionControl({
                compact: true,
                customAttribution: '<a href="https://twitter.com/shi__works" target="_blank">X(旧Twitter)</a> | <a href="https://github.com/shiwaku/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre" target="_blank">Github</a>',
            })
        );

        var container = '#comparison-container';
        var map = new maplibregl.Compare(beforeMap, afterMap, container, {});

        // 人口色分け用のフィルタ準備
        let p1 = ['all', ['>=', ['to-number', ['get', 'PopT']], 0], ['<', ['to-number', ['get', 'PopT']], 10]];
        let p2 = ['all', ['>=', ['to-number', ['get', 'PopT']], 10], ['<', ['to-number', ['get', 'PopT']], 20]];
        let p3 = ['all', ['>=', ['to-number', ['get', 'PopT']], 20], ['<', ['to-number', ['get', 'PopT']], 40]];
        let p4 = ['all', ['>=', ['to-number', ['get', 'PopT']], 40], ['<', ['to-number', ['get', 'PopT']], 60]];
        let p5 = ['all', ['>=', ['to-number', ['get', 'PopT']], 60], ['<', ['to-number', ['get', 'PopT']], 80]];
        let p6 = ['all', ['>=', ['to-number', ['get', 'PopT']], 80], ['<', ['to-number', ['get', 'PopT']], 1000000]];

        // 人口色分け用色の準備
        let pop_colors = ['#0000FF', '#00FFFF', '#00FF00', '#FFBF00', '#FF0000', '#CB00CB'];

        // 孤立集落人数色分け用のフィルタ準備
        let i1 = ['all', ['>=', ['to-number', ['get', 'number']], 0], ['<', ['to-number', ['get', 'number']], 1]];
        let i2 = ['all', ['>=', ['to-number', ['get', 'number']], 1], ['<', ['to-number', ['get', 'number']], 20]];
        let i3 = ['all', ['>=', ['to-number', ['get', 'number']], 20], ['<', ['to-number', ['get', 'number']], 40]];
        let i4 = ['all', ['>=', ['to-number', ['get', 'number']], 40], ['<', ['to-number', ['get', 'number']], 60]];
        let i5 = ['all', ['>=', ['to-number', ['get', 'number']], 60], ['<', ['to-number', ['get', 'number']], 80]];
        let i6 = ['all', ['>=', ['to-number', ['get', 'number']], 80], ['<', ['to-number', ['get', 'number']], 100]];
        let i7 = ['all', ['>=', ['to-number', ['get', 'number']], 100], ['<', ['to-number', ['get', 'number']], 150]];
        let i8 = ['all', ['>=', ['to-number', ['get', 'number']], 150], ['<', ['to-number', ['get', 'number']], 1000000]];

        // 孤立集落人数色分け用色の準備
        let isolated_colors = ['#E5CCFF', '#CC99FF', '#B265FF', '#9932FF', '#7F00FF', '#6500CB', '#4C0098', '#320065'];

        // マップをロード
        afterMap.on('load', () => {
            // 産総研 シームレス標高タイルソース
            afterMap.addSource('aist-dem', {
                type: 'raster-dem',
                tiles: ['numpng://tiles.gsj.jp/tiles/elev/mixed/{z}/{y}/{x}.png'],
                attribution: '<a href="https://tiles.gsj.jp/tiles/elev/tiles.html" target="_blank">産業技術総合研究所 シームレス標高タイル(統合DEM)</a>',
                tileSize: 256,
            });

            // 産総研 シームレス標高タイルセット
            // afterMap.setTerrain({ 'source': 'aist-dem', 'exaggeration': 1 });

            var opacity_value = 1;

            // ============================== 正射画像（撮影日別）==============================

            // 令和6年能登半島地震 輪島中地区　正射画像（2024年1月2日撮影）ソース
            afterMap.addSource('wazimanaka-0102', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_wazimanaka_0102do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 輪島中地区　正射画像（2024年1月2日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanaka-0102',
                type: 'raster',
                source: 'wazimanaka-0102',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 珠洲地区　正射画像（2024年1月2日撮影）ソース
            afterMap.addSource('suzu-0102', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_suzu_0102do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 珠洲地区　正射画像（2024年1月2日撮影）レイヤ
            afterMap.addLayer({
                id: 'suzu-0102',
                type: 'raster',
                source: 'suzu-0102',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島東地区　正射画像（2024年1月2日撮影）ソース
            afterMap.addSource('wazimahigashi-0102', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_wazimahigashi_0102do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 輪島東地区　正射画像（2024年1月2日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimahigashi-0102',
                type: 'raster',
                source: 'wazimahigashi-0102',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 七尾地区　正射画像（2024年1月5日撮影）ソース
            afterMap.addSource('nanao-0105', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102_noto_nanao_0105do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 七尾地区　正射画像（2024年1月5日撮影）レイヤ
            afterMap.addLayer({
                id: 'nanao-0105',
                type: 'raster',
                source: 'nanao-0105',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 珠洲地区　正射画像（2024年1月5日撮影）ソース
            afterMap.addSource('suzu-0105', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102_noto_suzu_0105do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 和6年能登半島地震 珠洲地区　正射画像（2024年1月5日撮影）レイヤ
            afterMap.addLayer({
                id: 'suzu-0105',
                type: 'raster',
                source: 'suzu-0105',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島中地区　正射画像（2024年1月5日撮影）ソース
            afterMap.addSource('wazimanaka-0105', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102_noto_wazimanaka_0105do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 輪島中地区　正射画像（2024年1月5日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanaka-0105',
                type: 'raster',
                source: 'wazimanaka-0105',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月5日撮影）ソース
            afterMap.addSource('anamizu-0105', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102_noto_anamizu_0105do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月5日撮影）レイヤ
            afterMap.addLayer({
                id: 'anamizu-0105',
                type: 'raster',
                source: 'anamizu-0105',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島中地区　正射画像（2024年1月11日撮影）ソース
            afterMap.addSource('wazimanaka-0111', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_wazimanaka_0111do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 輪島中地区　正射画像（2024年1月11日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanaka-0111',
                type: 'raster',
                source: 'wazimanaka-0111',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島西地区　正射画像（2024年1月11日撮影）ソース
            afterMap.addSource('wazimanishi-0111', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_wazimanishi_0111do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 輪島西地区　正射画像（2024年1月11日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanishi-0111',
                type: 'raster',
                source: 'wazimanishi-0111',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月11日撮影）ソース
            afterMap.addSource('anamizu-0111', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_anamizu_0111do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月11日撮影）レイヤ
            afterMap.addLayer({
                id: 'anamizu-0111',
                type: 'raster',
                source: 'anamizu-0111',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 珠洲地区　正射画像（2024年1月14日撮影）ソース
            afterMap.addSource('suzu-0114', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_suzu_0114do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 珠洲地区　正射画像（2024年1月14日撮影）レイヤ
            afterMap.addLayer({
                id: 'suzu-0114',
                type: 'raster',
                source: 'suzu-0114',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島東地区　正射画像（2024年1月14日撮影）ソース
            afterMap.addSource('wazimahigashi-0114', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_wazimahigashi_0114do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 輪島東地区　正射画像（2024年1月14日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimahigashi-0114',
                type: 'raster',
                source: 'wazimahigashi-0114',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月14日撮影）ソース
            afterMap.addSource('anamizu-0114', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_anamizu_0114do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月14日撮影）レイヤ
            afterMap.addLayer({
                id: 'anamizu-0114',
                type: 'raster',
                source: 'anamizu-0114',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 七尾地区　正射画像（2024年1月17日撮影）ソース
            afterMap.addSource('nanao-0117', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_nanao_0117do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 七尾地区　正射画像（2024年1月17日撮影）レイヤ
            afterMap.addLayer({
                id: 'nanao-0117',
                type: 'raster',
                source: 'nanao-0117',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月17日撮影）ソース
            afterMap.addSource('anamizu-0117', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_anamizu_0117do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月17日撮影）レイヤ
            afterMap.addLayer({
                id: 'anamizu-0117',
                type: 'raster',
                source: 'anamizu-0117',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島西地区　正射画像（2024年1月17日撮影）ソース
            afterMap.addSource('wazimanishi-0117', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_wazimanishi_0117do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // 令和6年能登半島地震 輪島西地区　正射画像（2024年1月17日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanishi-0117',
                type: 'raster',
                source: 'wazimanishi-0117',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 能登地区　正射画像（2024年4月5日～4月26日撮影）ソース
            afterMap.addSource('20240102noto_0405_0426', {
                type: 'raster',
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/20240102noto_0405_0426do/{z}/{x}/{y}.png'],
                attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>',
            });

            // ============================== 正射画像（全期間合成）==============================

            // 令和6年能登半島地震 珠洲地区　正射画像（2024年1月2日撮影）レイヤ
            afterMap.addLayer({
                id: 'suzu-0102-g',
                type: 'raster',
                source: 'suzu-0102',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            /*
            // 和6年能登半島地震 珠洲地区　正射画像（2024年1月5日撮影）レイヤ
            afterMap.addLayer({
                id: 'suzu-0105-g',
                type: 'raster',
                source: 'suzu-0105',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'visible',
                },
            });
            */

            // 令和6年能登半島地震 珠洲地区　正射画像（2024年1月14日撮影）レイヤ
            afterMap.addLayer({
                id: 'suzu-0114-g',
                type: 'raster',
                source: 'suzu-0114',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島中地区　正射画像（2024年1月11日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanaka-0111-g',
                type: 'raster',
                source: 'wazimanaka-0111',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島東地区　正射画像（2024年1月2日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimahigashi-0102-g',
                type: 'raster',
                source: 'wazimahigashi-0102',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島西地区　正射画像（2024年1月11日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanishi-0111-g',
                type: 'raster',
                source: 'wazimanishi-0111',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 輪島西地区　正射画像（2024年1月17日撮影）レイヤ
            afterMap.addLayer({
                id: 'wazimanishi-0117-g',
                type: 'raster',
                source: 'wazimanishi-0117',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 穴水地区　正射画像（2024年1月17日撮影）レイヤ
            afterMap.addLayer({
                id: 'anamizu-0117-g',
                type: 'raster',
                source: 'anamizu-0117',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 七尾地区　正射画像（2024年1月5日撮影）レイヤ
            afterMap.addLayer({
                id: 'nanao-0105-g',
                type: 'raster',
                source: 'nanao-0105',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 七尾地区　正射画像（2024年1月17日撮影）レイヤ
            afterMap.addLayer({
                id: 'nanao-0117-g',
                type: 'raster',
                source: 'nanao-0117',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'none',
                },
            });

            // 令和6年能登半島地震 能登地区　正射画像（2024年4月5日～4月26日撮影）レイヤ
            afterMap.addLayer({
                id: '20240102noto_0405_0426',
                type: 'raster',
                source: '20240102noto_0405_0426',
                paint: {
                    'raster-opacity': opacity_value,
                },
                layout: {
                    visibility: 'visible',
                },
            });

            // ============================== 斜面崩壊・堆積分布データ ==============================

            // 斜面崩壊・堆積分布データ（珠洲地区、輪島東地区）ソース
            afterMap.addSource('hokai_all_20240106_suzu-wajimaEAST', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/hokai_all_20240106_suzu-wajimaEAST.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 斜面崩壊・堆積分布データ（珠洲地区、輪島東地区）ラインレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240106_suzu-wajimaEAST-line',
                type: 'line',
                source: 'hokai_all_20240106_suzu-wajimaEAST',
                paint: {
                    'line-color': '#FF0000',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（珠洲地区、輪島東地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240106_suzu-wajimaEAST-fill',
                type: 'fill',
                source: 'hokai_all_20240106_suzu-wajimaEAST',
                paint: {
                    'fill-color': '#FF0000',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（輪島中地区）ソース
            afterMap.addSource('hokai_all_20240115_wajimaCENTRAL', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/hokai_all_20240115_wajimaCENTRAL_Re2.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 斜面崩壊・堆積分布データ（輪島中地区）ラインレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240115_wajimaCENTRAL-line',
                type: 'line',
                source: 'hokai_all_20240115_wajimaCENTRAL',
                paint: {
                    'line-color': '#FF0000',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（輪島中地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240115_wajimaCENTRAL-fill',
                type: 'fill',
                source: 'hokai_all_20240115_wajimaCENTRAL',
                paint: {
                    'fill-color': '#FF0000',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（穴水地区）ソース
            afterMap.addSource('hokai_all_20240118_anamizu', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/hokai_all_20240118_anamizu.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 斜面崩壊・堆積分布データ（穴水地区）ラインレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240118_anamizu-line',
                type: 'line',
                source: 'hokai_all_20240118_anamizu',
                paint: {
                    'line-color': '#FF0000',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（穴水地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240118_anamizu-fill',
                type: 'fill',
                source: 'hokai_all_20240118_anamizu',
                paint: {
                    'fill-color': '#FF0000',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（七尾地区）ソース
            afterMap.addSource('hokai_all_20240118_nanao', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/hokai_all_20240118_nanao.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 斜面崩壊・堆積分布データ（七尾地区）ラインレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240118_nanao-line',
                type: 'line',
                source: 'hokai_all_20240118_nanao',
                paint: {
                    'line-color': '#FF0000',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（七尾地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'hokai_all_20240118_nanao-fill',
                type: 'fill',
                source: 'hokai_all_20240118_nanao',
                paint: {
                    'fill-color': '#FF0000',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（輪島西地区）ソース
            afterMap.addSource('hokai_20240122_wajimaWEST', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/hokai_20240122_wajimaWEST.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 斜面崩壊・堆積分布データ（輪島西地区）ラインレイヤ
            afterMap.addLayer({
                id: 'hokai_20240122_wajimaWEST-line',
                type: 'line',
                source: 'hokai_20240122_wajimaWEST',
                paint: {
                    'line-color': '#FF0000',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 斜面崩壊・堆積分布データ（輪島西地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'hokai_20240122_wajimaWEST-fill',
                type: 'fill',
                source: 'hokai_20240122_wajimaWEST',
                paint: {
                    'fill-color': '#FF0000',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // ============================== 津波浸水域（推定） ==============================

            // 空中写真判読による津波浸水域（推定）（珠洲地区、輪島東地区）ソース
            afterMap.addSource('tsunami_suzu-wajimaEAST', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/shinsui-tsunami-area_suzu-wajimaEAST-Re2_20240110.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 空中写真判読による津波浸水域（推定）（珠洲地区、輪島東地区）ラインレイヤ
            afterMap.addLayer({
                id: 'tsunami_suzu-wajimaEAST-line',
                type: 'line',
                source: 'tsunami_suzu-wajimaEAST',
                paint: {
                    'line-color': '#0000FF',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真判読による津波浸水域（推定）（珠洲地区、輪島東地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'tsunami_suzu-wajimaEAST-fill',
                type: 'fill',
                source: 'tsunami_suzu-wajimaEAST',
                paint: {
                    'fill-color': '#0000FF',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真判読による津波浸水域（推定）（穴水地区）ソース
            afterMap.addSource('tsunami_anamizu', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/shinsui-tsunami-area_anamizu_20240118.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 空中写真判読による津波浸水域（推定）（穴水地区）ラインレイヤ
            afterMap.addLayer({
                id: 'tsunami_anamizu-line',
                type: 'line',
                source: 'tsunami_anamizu',
                paint: {
                    'line-color': '#0000FF',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真判読による津波浸水域（推定）（穴水地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'tsunami_anamizu-fill',
                type: 'fill',
                source: 'tsunami_anamizu',
                paint: {
                    'fill-color': '#0000FF',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真判読による津波浸水域（推定）（七尾地区）ソース
            afterMap.addSource('tsunami_nanao', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/shinsui-tsunami-area_nanao_20240118.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 空中写真判読による津波浸水域（推定）（七尾地区）ラインレイヤ
            afterMap.addLayer({
                id: 'tsunami_nanao-line',
                type: 'line',
                source: 'tsunami_nanao',
                paint: {
                    'line-color': '#0000FF',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真判読による津波浸水域（推定）（七尾地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'tsunami_nanao-fill',
                type: 'fill',
                source: 'tsunami_nanao',
                paint: {
                    'fill-color': '#0000FF',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真判読による津波浸水域（推定）（輪島西地区）ソース
            afterMap.addSource('tsunami_wajimaWEST', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/shinsui-tsunami-area_wajimaWEST_20240112.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 空中写真判読による津波浸水域（推定）（輪島西地区）ラインレイヤ
            afterMap.addLayer({
                id: 'tsunami_wajimaWEST-line',
                type: 'line',
                source: 'tsunami_wajimaWEST',
                paint: {
                    'line-color': '#0000FF',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真判読による津波浸水域（推定）（輪島西地区）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'tsunami_wajimaWEST-fill',
                type: 'fill',
                source: 'tsunami_wajimaWEST',
                paint: {
                    'fill-color': '#0000FF',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // ============================== 海岸線が前進した範囲 ==============================

            // 海岸線が前進した範囲（空中写真・衛星画像）ソース
            afterMap.addSource('Uplift', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/Uplift_mapping_NotoEQ_ver3.geojson',
                attribution: '<a href="https://ajg-disaster.blogspot.com/2024/01/2024_2.html">日本地理学会 令和6年能登半島地震変動地形調査グループ（海岸線が前進した範囲）</a>',
            });

            // 海岸線が前進した範囲（空中写真・衛星画像）ラインレイヤ
            afterMap.addLayer({
                id: 'Uplift-line',
                type: 'line',
                source: 'Uplift',
                paint: {
                    'line-color': '#BF00FF',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 海岸線が前進した範囲（空中写真・衛星画像）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'Uplift-fill',
                type: 'fill',
                source: 'Uplift',
                paint: {
                    'fill-color': '#BF00FF',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // ============================== 火災焼失範囲 ==============================

            // 空中写真等の画像判読による輪島市中心の火災焼失範囲（推定）ソース
            afterMap.addSource('fire_wajima', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/20240112_輪島市火災範囲（推定）.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 空中写真等の画像判読による輪島市中心の火災焼失範囲（推定）ラインレイヤ
            afterMap.addLayer({
                id: 'fire_wajima-line',
                type: 'line',
                source: 'fire_wajima',
                paint: {
                    'line-color': '#FF7F00',
                    'line-width': 2,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // 空中写真等の画像判読による輪島市中心の火災焼失範囲（推定）ポリゴンレイヤ
            afterMap.addLayer({
                id: 'fire_wajima-fill',
                type: 'fill',
                source: 'fire_wajima',
                paint: {
                    'fill-color': '#FF7F00',
                    'fill-opacity': 0.1,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // ============================== 陸化したと思われる港 ==============================

            // 陸化したと思われる港ソース
            afterMap.addSource('uplift-port', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/漁港の隆起_Ver3.0.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // PNGソース追加
            afterMap.loadImage('https://maps.gsi.go.jp/portal/sys/v4/symbols/080.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('port_symbol_080', image);
            });

            // PNGソース追加
            afterMap.loadImage('https://maps.gsi.go.jp/portal/sys/v4/symbols/082.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('port_symbol_082', image);
            });

            // 陸化したと思われる港シンボルレイヤ
            afterMap.addLayer({
                id: 'uplift-port-symbol',
                type: 'symbol',
                source: 'uplift-port',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': ['match', ['get', '_iconUrl'], 'https://maps.gsi.go.jp/portal/sys/v4/symbols/080.png', 'port_symbol_080', 'https://maps.gsi.go.jp/portal/sys/v4/symbols/082.png', 'port_symbol_082', 'port_symbol_080'],
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'visible',
                },
            });

            // 陸化したと思われる港ラベルレイヤ
            afterMap.addLayer({
                id: 'uplift-port-labels',
                type: 'symbol',
                source: 'uplift-port',
                minzoom: 9,
                maxzoom: 18,
                layout: {
                    'text-field': ['get', 'name'],
                    'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
                    'text-size': 12,
                    'text-anchor': 'center',
                    'text-justify': 'center',
                    'text-offset': [0, -1.3],
                    'text-allow-overlap': true,
                    visibility: 'visible',
                },
                paint: {
                    'text-color': 'rgba(0, 0, 0, 1)',
                    'text-halo-color': 'rgba(255, 255, 255, 1)',
                    'text-halo-width': 2,
                },
            });

            // ============================== 亀裂箇所 ==============================

            // 亀裂箇所ソース
            afterMap.addSource('cracks', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/noto_cracks_20240214.geojson',
                attribution: '<a href="https://www.gsi.go.jp/BOUSAI/20240101_noto_earthquake.html">国土地理院 令和6年(2024年)能登半島地震に関する情報</a>',
            });

            // 亀裂箇所ラインレイヤ
            afterMap.addLayer({
                id: 'cracks-lines',
                type: 'line',
                source: 'cracks',
                paint: {
                    'line-color': 'rgba(255, 0, 191, 1)',
                    'line-width': 5,
                },
                layout: {
                    visibility: 'visible',
                }
            });

            // ============================== 石川県孤立集落人数（ポリゴン） ==============================

            // 石川県孤立集落人数ポリゴンソース
            afterMap.addSource('Number_of_isolated_area', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/Number_of_isolated_area0121_EPSG4326.geojson',
                attribution: '<a href="https://www.pref.ishikawa.lg.jp/saigai/202401jishin-taisakuhonbu.html#honbu" target="_blank">石川県 災害対策本部員会議資料（孤立集落人数）</a>',
            });

            // 石川県孤立集落人数ポリゴンレイヤ
            afterMap.addLayer({
                id: 'Number_of_isolated_area-fill',
                type: 'fill',
                source: 'Number_of_isolated_area',
                layout: {
                    visibility: 'none',
                },
                paint: {
                    'fill-color': ['case', i1, isolated_colors[0], i2, isolated_colors[1], i3, isolated_colors[2], i4, isolated_colors[3], i5, isolated_colors[4], i6, isolated_colors[5], i7, isolated_colors[6], i8, isolated_colors[7], isolated_colors[7]],
                    'fill-opacity': 0.5,
                },
            });

            // 石川県孤立集落人数ラインレイヤ
            afterMap.addLayer({
                id: 'Number_of_isolated_area-line',
                type: 'line',
                source: 'Number_of_isolated_area',
                layout: {
                    visibility: 'none',
                },
                paint: {
                    'line-color': '#FFFFFF',
                    'line-width': 2,
                },
            });

            // ============================== 令和2年簡易100mメッシュ人口 ==============================

            // 令和2年簡易100mメッシュ人口（石川県）ソース
            afterMap.addSource('100m_mesh_pop2020_ishikawa', {
                type: 'vector',
                url: 'pmtiles://https://xs489works.xsrv.jp/pmtiles-data/100m_mesh_pop2020/100m_mesh_pop2020_ishikawa.pmtiles',
                attribution: '<a href="https://gtfs-gis.jp/teikyo/index.html" target="_blank">地域・交通データ研究所 簡易100mメッシュ人口データ(2020年国勢調査ベース)</a>',
            });

            // 令和2年簡易100mメッシュ人口（石川県）レイヤ
            afterMap.addLayer({
                id: '100m_mesh_pop2020_ishikawa-fill',
                type: 'fill-extrusion',
                source: '100m_mesh_pop2020_ishikawa',
                'source-layer': '100m_mesh_pop2020_ishikawafgb',
                layout: {
                    visibility: 'none',
                },
                paint: {
                    'fill-extrusion-color': ['case', p1, pop_colors[0], p2, pop_colors[1], p3, pop_colors[2], p4, pop_colors[3], p5, pop_colors[4], p6, pop_colors[5], pop_colors[5]],
                    'fill-extrusion-height': ['*', ['to-number', ['get', 'PopT']], 10],
                    'fill-extrusion-opacity': 0.5,
                },
            });

            // 令和2年簡易100mメッシュ人口（富山県）ソース
            afterMap.addSource('100m_mesh_pop2020_toyama', {
                type: 'vector',
                url: 'pmtiles://https://xs489works.xsrv.jp/pmtiles-data/100m_mesh_pop2020/100m_mesh_pop2020_toyama.pmtiles',
                attribution: '<a href="https://gtfs-gis.jp/teikyo/index.html" target="_blank">地域・交通データ研究所 簡易100mメッシュ人口データ(2020年国勢調査ベース)</a>',
            });

            // 令和2年簡易100mメッシュ人口（富山県）レイヤ
            afterMap.addLayer({
                id: '100m_mesh_pop2020_toyama-fill',
                type: 'fill-extrusion',
                source: '100m_mesh_pop2020_toyama',
                'source-layer': '100m_mesh_pop2020_toyamafgb',
                layout: {
                    visibility: 'none',
                },
                paint: {
                    'fill-extrusion-color': ['case', p1, pop_colors[0], p2, pop_colors[1], p3, pop_colors[2], p4, pop_colors[3], p5, pop_colors[4], p6, pop_colors[5], pop_colors[5]],
                    'fill-extrusion-height': ['*', ['to-number', ['get', 'PopT']], 10],
                    'fill-extrusion-opacity': 0.5,
                },
            });

            // ============================== 石川県孤立集落人数（ラベル） ==============================

            // 石川県 孤立集落人数重心ソース
            afterMap.addSource('Number_of_isolated_area_centroid', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/Number_of_isolated_area0121_centroid_EPSG4326.geojson',
                attribution: '<a href="https://www.pref.ishikawa.lg.jp/saigai/202401jishin-taisakuhonbu.html#honbu" target="_blank">石川県 災害対策本部員会議資料（孤立集落人数）</a>',
            });

            // 石川県 孤立集落人数ラベルレイヤ
            afterMap.addLayer({
                id: 'Number_of_isolated_area_centroid-label',
                type: 'symbol',
                source: 'Number_of_isolated_area_centroid',
                layout: {
                    'text-field': ['get', '孤立集落名'],
                    // 'text-field': ['concat', ['get', '孤立集落人数'], '\n', ['to-string', ['get', 'number']]],
                    'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
                    'text-size': 14,
                    'text-anchor': 'top',
                    'symbol-placement': 'point',
                    'text-allow-overlap': true,
                    'symbol-spacing': 1000,
                    visibility: 'none',
                },
                paint: {
                    'text-color': 'rgba(0, 0, 0, 1)',
                    'text-halo-blur': 1,
                    'text-halo-color': 'rgba(255, 255, 255, 1)',
                    'text-halo-width': 2,
                },
            });

            // ============================== 国土交通省 道路復旧見える化マップ ==============================

            // 緊急復旧済み区間ソース
            afterMap.addSource('emergency_restored_section', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/emergency_restored_section.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // 緊急復旧済み区間ラインレイヤ
            afterMap.addLayer({
                id: 'emergency_restored_section-line',
                type: 'line',
                source: 'emergency_restored_section',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    visibility: 'none',
                },
                paint: {
                    'line-color': ['match', ['get', '_color'], '#0000FF', '#0000FF', '#990000', '#990000', '#6AA84F', '#00B050', '#FF00FF', '#FF00FF', '#000000', '#000000', '#00FFFF', '#00FFFF', '#38761D', '#38761D', '#660000', '#660000', '#CC0000', '#CC0000', '#656565'],
                    'line-width': 8,
                    'line-opacity': 0.8,
                },
            });

            // ETC2.0速度データ(平均速度)ソース
            afterMap.addSource('ETC2.0_speed_data', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/ETC2.0_speed_data.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // ETC2.0速度データ(平均速度)ラインレイヤ
            afterMap.addLayer({
                id: 'ETC2.0_speed_data-line',
                type: 'line',
                source: 'ETC2.0_speed_data',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    visibility: 'none',
                },
                paint: {
                    'line-color': ['match', ['get', '_color'], '#ff0000', '#ff0000', '#ff9900', '#ff9900', '#00ff00', '#00ff00', '#0000ff', '#0000ff', '#656565'],
                    'line-width': 3,
                },
            });

            // 啓開前・啓開後比較箇所ソース
            afterMap.addSource('before_after', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/before_after.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // PNGソース追加
            afterMap.loadImage('https://maps.gsi.go.jp/portal/sys/v4/symbols/482.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('before_after_symbol', image);
            });

            // 啓開前・啓開後比較箇所シンボルレイヤ
            afterMap.addLayer({
                id: 'before_after-symbol',
                type: 'symbol',
                source: 'before_after',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': 'before_after_symbol',
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1.2, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'none',
                },
            });

            // 啓開作業状況ソース
            afterMap.addSource('sagyou', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/sagyou.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // PNGソース追加
            afterMap.loadImage('https://maps.gsi.go.jp/portal/sys/v4/symbols/482.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('sagyou_symbol_482', image);
            });

            // PNGソース追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/icon_movie.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('sagyou_symbol_icon_movie', image);
            });

            // PNGソース追加
            afterMap.loadImage('https://maps.gsi.go.jp/portal/sys/v4/symbols/537.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('sagyou_symbol_537', image);
            });

            // PNGソース追加
            afterMap.loadImage('https://maps.gsi.go.jp/portal/sys/v4/symbols/562.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('sagyou_symbol_562', image);
            });

            // 啓開作業状況シンボルレイヤ
            afterMap.addLayer({
                id: 'sagyou-symbol',
                type: 'symbol',
                source: 'sagyou',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': [
                        'match',
                        ['get', '_iconUrl'],
                        'https://maps.gsi.go.jp/portal/sys/v4/symbols/482.png',
                        'sagyou_symbol_482',
                        // 'https://maps.gsi.go.jp/portal/sys/v4/symbols/494.png', 'sagyou_symbol_494',
                        // 'https://maps.gsi.go.jp/portal/sys/v4/symbols/538.png', 'sagyou_symbol_538',
                        // 'https://maps.gsi.go.jp/portal/sys/v4/symbols/563.png', 'sagyou_symbol_563',
                        // 'https://maps.gsi.go.jp/portal/sys/v4/symbols/570.png', 'sagyou_symbol_570',
                        'https://www.mlit.go.jp/road/r6noto/map/img/icon_movie.png',
                        'sagyou_symbol_icon_movie',
                        'https://maps.gsi.go.jp/portal/sys/v4/symbols/537.png',
                        'sagyou_symbol_537',
                        'https://maps.gsi.go.jp/portal/sys/v4/symbols/562.png',
                        'sagyou_symbol_562',
                        'sagyou_symbol_482',
                    ],
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1.2, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'none',
                },
            });

            // 復旧到達地点ソース
            afterMap.addSource('recovery_point', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/recovery_point.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // PNGソース（沿岸部への到達点）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/087.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('recovery_point_087', image);
            });

            // PNGソース（国復旧業者作業箇所）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/319.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('recovery_point_319', image);
            });

            // PNGソース（国復旧業者到達済み箇所）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/802.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('recovery_point_802', image);
            });

            // 復旧到達地点シンボルレイヤ
            afterMap.addLayer({
                id: 'recovery_point-symbol',
                type: 'symbol',
                source: 'recovery_point',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': ['match', ['get', '_iconUrl'], 'https://maps.gsi.go.jp/portal/sys/v4/symbols/087.png', 'recovery_point_087', 'https://maps.gsi.go.jp/portal/sys/v4/symbols/319.png', 'recovery_point_319', 'https://maps.gsi.go.jp/portal/sys/v4/symbols/802.png', 'recovery_point_802', 'recovery_point_087'],
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1.2, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'none',
                },
            });

            // 主な被災箇所ソース
            afterMap.addSource('damaged_area', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/damaged_area.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // PNGソース（被害規模 大）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/092.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('damaged_area_092', image);
            });

            // PNGソース（被害規模 小～中程度）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/096.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('damaged_area_096', image);
            });

            // PNGソース（復旧済（緊急復旧含む））追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/699.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('damaged_area_699', image);
            });

            // 主な被災箇所シンボルレイヤ
            afterMap.addLayer({
                id: 'damaged_area-symbol',
                type: 'symbol',
                source: 'damaged_area',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': ['match', ['get', '被災規模'], '大', 'damaged_area_092', '小～中', 'damaged_area_096', 'NULL', 'damaged_area_699', 'damaged_area_699'],
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1.2, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'none',
                },
            });

            /*
        // 被災状況（空撮）ソース
        afterMap.addSource("damage_situation_aerial_photography", {
            type: "geojson",
            data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/damage_situation_aerial_photography.geojson',
            attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
        });

        // PNGソース追加
        afterMap.loadImage('https://maps.gsi.go.jp/portal/sys/v4/symbols/186.png',
            function (error, image) {
                if (error) throw error;
                afterMap.addImage('damage_situation_aerial_photography_186', image);
            }
        );

        // 被災状況（空撮）シンボルレイヤ
        afterMap.addLayer({
            'id': 'damage_situation_aerial_photography-symbol',
            "type": "symbol",
            'source': 'damage_situation_aerial_photography',
            minzoom: 1,
            maxzoom: 23,
            "layout": {
                'icon-image': 'damage_situation_aerial_photography_186',
                "icon-size": [
                    'interpolate',
                    ['linear'],
                    ['zoom'],
                    1, 0.1,  // ズームレベル1でサイズは0.1
                    12, 1.2  // ズームレベル12でサイズは1.2
                ],
                "icon-allow-overlap": true, // シンボルの重なりを許可
                'visibility': 'none',
                'icon-rotate': [
                    'match',
                    ['get', '_iconUrl'],
                    'https://maps.gsi.go.jp/portal/sys/v4/symbols/181.png', 180 - 45,
                    'https://maps.gsi.go.jp/portal/sys/v4/symbols/182.png', 180,
                    'https://maps.gsi.go.jp/portal/sys/v4/symbols/183.png', 180 + 45,
                    'https://maps.gsi.go.jp/portal/sys/v4/symbols/184.png', 270,
                    'https://maps.gsi.go.jp/portal/sys/v4/symbols/185.png', 180 + 135,
                    'https://maps.gsi.go.jp/portal/sys/v4/symbols/186.png', 0,
                    'https://maps.gsi.go.jp/portal/sys/v4/symbols/187.png', 180 + 225,
                    90 // デフォルト値
                ]
            }
        });
        */

            // 支援拠点の道の駅ソース
            afterMap.addSource('michinoeki', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/michinoeki.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // PNGソース（道の駅）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/474.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('michinoeki_474', image);
            });

            // 支援拠点の道の駅シンボルレイヤ
            afterMap.addLayer({
                id: 'michinoeki-symbol',
                type: 'symbol',
                source: 'michinoeki',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': 'michinoeki_474',
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1.2, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'none',
                },
            });

            // 市町道路の状況把握結果ソース
            afterMap.addSource('municipal_road_investigation', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/municipal_road_investigation.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // PNGソース（道の駅）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/chikunaiicon.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('chikunaiicon', image);
            });

            // 市町道路の状況把握結果シンボルレイヤ
            afterMap.addLayer({
                id: 'municipal_road_investigation-symbol',
                type: 'symbol',
                source: 'municipal_road_investigation',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': 'chikunaiicon',
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1.2, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'none',
                },
            });

            // 被災状況（360度画像/三次元点群データ）ソース
            afterMap.addSource('spherical_image', {
                type: 'geojson',
                data: 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/spherical_image.geojson',
                attribution: '<a href="https://www.mlit.go.jp/road/r6noto/index2.html" target="_blank">国土交通省 令和6年能登半島地震 道路復旧見える化マップ</a>',
            });

            // PNGソース（道の駅）追加
            afterMap.loadImage('https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/icon_360.png', function (error, image) {
                if (error) throw error;
                afterMap.addImage('icon_360', image);
            });

            // 被災状況（360度画像/三次元点群データ）シンボルレイヤ
            afterMap.addLayer({
                id: 'spherical_image-symbol',
                type: 'symbol',
                source: 'spherical_image',
                minzoom: 1,
                maxzoom: 23,
                layout: {
                    'icon-image': 'icon_360',
                    'icon-size': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        1,
                        0.1, // ズームレベル1でサイズは0.1
                        12,
                        1.2, // ズームレベル12でサイズは1.2
                    ],
                    'icon-allow-overlap': true, // シンボルの重なりを許可
                    visibility: 'none',
                },
            });
        });

        // ============================== 石川県七尾市避難所開設情報 ==============================

        // PNGソース追加
        afterMap.loadImage('./img/skhb.png', function (error, image) {
            if (error) throw error;
            afterMap.addImage('skhb', image);
        });

        // EPSG:6675の定義を追加（カスタム定義が必要）
        proj4.defs('EPSG:6675', '+proj=tmerc +lat_0=36 +lon_0=137.16666666666666 +k=1 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs');

        // 指定されたURLからGeoJSONを取得し、座標変換を行う
        fetch('https://raokiey.github.io/R06-Noto-Peninsula-EQ-open-shelter-Nanao/data/latest/open_shelter_Nanao-shi.geojson')
            .then((response) => response.json())
            .then((geojson) => {
                geojson.features.forEach((feature) => {
                    if (feature.geometry.type === 'Point') {
                        feature.geometry.coordinates = proj4('EPSG:6675', 'EPSG:4326', feature.geometry.coordinates);
                    }
                });

                // 変換されたGeoJSONをマップに表示
                afterMap.on('load', function () {
                    afterMap.addSource('open_shelter_Nanao-shi', {
                        type: 'geojson',
                        data: geojson,
                        attribution: '<a href="https://www.city.nanao.lg.jp/bosai/mail/202401021200.html" target="_blank">石川県七尾市Webサイト 開設中の避難所情報</a>',
                    });

                    // 七尾市避難所開設情報シンボルレイヤ
                    afterMap.addLayer({
                        id: 'open_shelter_Nanao-shi-symbol',
                        type: 'symbol',
                        source: 'open_shelter_Nanao-shi',
                        minzoom: 1,
                        maxzoom: 23,
                        layout: {
                            'icon-image': 'skhb',
                            'icon-size': [
                                'interpolate',
                                ['linear'],
                                ['zoom'],
                                1,
                                0.1, // ズームレベル1でサイズは0.1
                                12,
                                0.75, // ズームレベル12でサイズは0.75
                            ],
                            'icon-allow-overlap': true, // シンボルの重なりを許可
                            visibility: 'none',
                        },
                    });

                    // 七尾市避難所開設情報ラベルレイヤ
                    afterMap.addLayer({
                        id: 'open_shelter_Nanao-shi-label',
                        type: 'symbol',
                        source: 'open_shelter_Nanao-shi',
                        minzoom: 13,
                        maxzoom: 23,
                        layout: {
                            'text-field': ['get', '名称'],
                            'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],
                            'text-size': 12,
                            'text-offset': [0, 2],
                            'text-allow-overlap': true,
                            'text-ignore-placement': false,
                            'text-max-width': 20, // テキストが折り返される前の最大幅を設定
                            visibility: 'none',
                        },
                        paint: {
                            'text-color': 'rgba(0, 0, 0, 1)',
                            'text-halo-blur': 1,
                            'text-halo-color': 'rgba(255, 255, 255, 1)',
                            'text-halo-width': 2,
                        },
                    });
                });
            });

        // ============================== スライダーで空中写真の不透明度を制御 ==============================

        const photosliderOpactiy = document.getElementById('photo-slider-opacity');
        const photosliderOpactiyValue = document.getElementById('photo-slider-opacity-value');

        photosliderOpactiy.addEventListener('input', (e) => {
            beforeMap.setPaintProperty('ishikawa-ortho', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            beforeMap.setPaintProperty('seamlessphoto', 'raster-opacity', parseInt(e.target.value, 10) / 100);

            // 全期間合成（2024年04月05日撮影～2024年04月26日撮影）
            afterMap.setPaintProperty('20240102noto_0405_0426', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            // 全期間合成（2024年01月02日撮影～2024年01月17日撮影）
            afterMap.setPaintProperty('suzu-0102-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            // afterMap.setPaintProperty('suzu-0105-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('suzu-0114-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanaka-0111-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimahigashi-0102-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanishi-0111-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanishi-0117-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('anamizu-0117-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('nanao-0105-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('nanao-0117-g', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            // 撮影日別
            afterMap.setPaintProperty('wazimahigashi-0102', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanaka-0102', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('suzu-0102', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('nanao-0105', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('anamizu-0105', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanaka-0105', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('suzu-0105', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanaka-0111', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanishi-0111', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('anamizu-0111', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimahigashi-0114', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('anamizu-0114', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('suzu-0114', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('wazimanishi-0117', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('anamizu-0117', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            afterMap.setPaintProperty('nanao-0117', 'raster-opacity', parseInt(e.target.value, 10) / 100);
            photosliderOpactiyValue.textContent = e.target.value + '%';
        });

        // ============================== レイヤの表示・非表示切り替え制御 ==============================

        // 国土地理院 発災前の空中写真の表示・非表示切り替え制御

        // 2020年・2022年撮影
        document.getElementById('2020_2022').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                beforeMap.setLayoutProperty('ishikawa-ortho', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                beforeMap.setLayoutProperty('ishikawa-ortho', 'visibility', 'none');
            }
        });

        // 2010年4月～5月頃撮影
        document.getElementById('201004_05').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                beforeMap.setLayoutProperty('seamlessphoto', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                beforeMap.setLayoutProperty('seamlessphoto', 'visibility', 'none');
            }
        });

        // 国土地理院 発災後の空中写真の表示・非表示切り替え制御

        // 2024年04月05日～04月26日撮影
        document.getElementById('20240405-20240426').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('20240102noto_0405_0426', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('20240102noto_0405_0426', 'visibility', 'none');
            }
        });

        // 全期間合成（2024年01月02日撮影～2024年01月17日撮影）
        document.getElementById('20240102-20240117').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('suzu-0102-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('suzu-0105-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('wazimanaka-0111-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('wazimahigashi-0102-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('wazimanishi-0111-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('wazimanishi-0117-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('anamizu-0117-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('nanao-0105-g', 'visibility', 'visible');
                afterMap.setLayoutProperty('nanao-0117-g', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('suzu-0102-g', 'visibility', 'none');
                afterMap.setLayoutProperty('suzu-0105-g', 'visibility', 'none');
                afterMap.setLayoutProperty('wazimanaka-0111-g', 'visibility', 'none');
                afterMap.setLayoutProperty('wazimahigashi-0102-g', 'visibility', 'none');
                afterMap.setLayoutProperty('wazimanishi-0111-g', 'visibility', 'none');
                afterMap.setLayoutProperty('wazimanishi-0117-g', 'visibility', 'none');
                afterMap.setLayoutProperty('anamizu-0117-g', 'visibility', 'none');
                afterMap.setLayoutProperty('nanao-0105-g', 'visibility', 'none');
                afterMap.setLayoutProperty('nanao-0117-g', 'visibility', 'none');
            }
        });

        // 2024年01月02日撮影
        document.getElementById('20240102').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('wazimahigashi-0102', 'visibility', 'visible');
                afterMap.setLayoutProperty('wazimanaka-0102', 'visibility', 'visible');
                afterMap.setLayoutProperty('suzu-0102', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('wazimahigashi-0102', 'visibility', 'none');
                afterMap.setLayoutProperty('wazimanaka-0102', 'visibility', 'none');
                afterMap.setLayoutProperty('suzu-0102', 'visibility', 'none');
            }
        });

        // 2024年01月05日撮影
        document.getElementById('20240105').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('nanao-0105', 'visibility', 'visible');
                afterMap.setLayoutProperty('anamizu-0105', 'visibility', 'visible');
                afterMap.setLayoutProperty('wazimanaka-0105', 'visibility', 'visible');
                afterMap.setLayoutProperty('suzu-0105', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('nanao-0105', 'visibility', 'none');
                afterMap.setLayoutProperty('anamizu-0105', 'visibility', 'none');
                afterMap.setLayoutProperty('wazimanaka-0105', 'visibility', 'none');
                afterMap.setLayoutProperty('suzu-0105', 'visibility', 'none');
            }
        });

        // 2024年01月11日撮影
        document.getElementById('20240111').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('wazimanaka-0111', 'visibility', 'visible');
                afterMap.setLayoutProperty('wazimanishi-0111', 'visibility', 'visible');
                afterMap.setLayoutProperty('anamizu-0111', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('wazimanaka-0111', 'visibility', 'none');
                afterMap.setLayoutProperty('wazimanishi-0111', 'visibility', 'none');
                afterMap.setLayoutProperty('anamizu-0111', 'visibility', 'none');
            }
        });

        // 2024年01月14日撮影
        document.getElementById('20240114').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('wazimahigashi-0114', 'visibility', 'visible');
                afterMap.setLayoutProperty('anamizu-0114', 'visibility', 'visible');
                afterMap.setLayoutProperty('suzu-0114', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('wazimahigashi-0114', 'visibility', 'none');
                afterMap.setLayoutProperty('anamizu-0114', 'visibility', 'none');
                afterMap.setLayoutProperty('suzu-0114', 'visibility', 'none');
            }
        });

        // 2024年01月17日撮影
        document.getElementById('20240117').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('wazimanishi-0117', 'visibility', 'visible');
                afterMap.setLayoutProperty('anamizu-0117', 'visibility', 'visible');
                afterMap.setLayoutProperty('nanao-0117', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('wazimanishi-0117', 'visibility', 'none');
                afterMap.setLayoutProperty('anamizu-0117', 'visibility', 'none');
                afterMap.setLayoutProperty('nanao-0117', 'visibility', 'none');
            }
        });

        // 斜面崩壊・堆積範囲
        document.getElementById('hokai').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('hokai_all_20240106_suzu-wajimaEAST-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_all_20240106_suzu-wajimaEAST-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_all_20240115_wajimaCENTRAL-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_all_20240115_wajimaCENTRAL-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_all_20240118_anamizu-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_all_20240118_anamizu-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_all_20240118_nanao-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_all_20240118_nanao-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_20240122_wajimaWEST-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('hokai_20240122_wajimaWEST-fill', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('hokai_all_20240106_suzu-wajimaEAST-line', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_all_20240106_suzu-wajimaEAST-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_all_20240115_wajimaCENTRAL-line', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_all_20240115_wajimaCENTRAL-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_all_20240118_anamizu-line', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_all_20240118_anamizu-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_all_20240118_nanao-line', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_all_20240118_nanao-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_20240122_wajimaWEST-line', 'visibility', 'none');
                afterMap.setLayoutProperty('hokai_20240122_wajimaWEST-fill', 'visibility', 'none');
            }
        });

        // 津波浸水範囲
        document.getElementById('tsunami').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('tsunami_suzu-wajimaEAST-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('tsunami_suzu-wajimaEAST-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('tsunami_anamizu-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('tsunami_anamizu-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('tsunami_nanao-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('tsunami_nanao-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('tsunami_wajimaWEST-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('tsunami_wajimaWEST-fill', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('tsunami_suzu-wajimaEAST-line', 'visibility', 'none');
                afterMap.setLayoutProperty('tsunami_suzu-wajimaEAST-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('tsunami_anamizu-line', 'visibility', 'none');
                afterMap.setLayoutProperty('tsunami_anamizu-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('tsunami_nanao-line', 'visibility', 'none');
                afterMap.setLayoutProperty('tsunami_nanao-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('tsunami_wajimaWEST-line', 'visibility', 'none');
                afterMap.setLayoutProperty('tsunami_wajimaWEST-fill', 'visibility', 'none');
            }
        });

        // 海岸線が前進した範囲
        document.getElementById('Uplift').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('Uplift-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('Uplift-fill', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('Uplift-line', 'visibility', 'none');
                afterMap.setLayoutProperty('Uplift-fill', 'visibility', 'none');
            }
        });

        // 輪島市中心の火災焼失範囲
        document.getElementById('fire').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('fire_wajima-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('fire_wajima-fill', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('fire_wajima-line', 'visibility', 'none');
                afterMap.setLayoutProperty('fire_wajima-fill', 'visibility', 'none');
            }
        });

        // 陸化したと思われる港
        document.getElementById('uplift-port').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('uplift-port-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('uplift-port-labels', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('uplift-port-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('uplift-port-labels', 'visibility', 'none');
            }
        });

        // 亀裂箇所
        document.getElementById('cracks').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('cracks-lines', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('cracks-lines', 'visibility', 'none');
            }
        });

        // 国土交通省 道路復旧見える化マップの表示・非表示切り替え制御
        document.getElementById('road-map').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('emergency_restored_section-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('ETC2.0_speed_data-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('before_after-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('sagyou-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('recovery_point-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('damaged_area-symbol', 'visibility', 'visible');
                // afterMap.setLayoutProperty('damage_situation_aerial_photography-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('michinoeki-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('municipal_road_investigation-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('spherical_image-symbol', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('emergency_restored_section-line', 'visibility', 'none');
                afterMap.setLayoutProperty('ETC2.0_speed_data-line', 'visibility', 'none');
                afterMap.setLayoutProperty('before_after-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('sagyou-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('recovery_point-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('damaged_area-symbol', 'visibility', 'none');
                // afterMap.setLayoutProperty('damage_situation_aerial_photography-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('michinoeki-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('municipal_road_investigation-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('spherical_image-symbol', 'visibility', 'none');
            }
        });

        // 簡易100mメッシュ人口の表示・非表示切り替え制御
        document.getElementById('pop-map').addEventListener('change', function (e) {
            // var legend = document.getElementById('legend-pop');
            if (e.target.checked) {
                // チェックボックスがON - レイヤーと凡例を表示
                afterMap.setLayoutProperty('100m_mesh_pop2020_ishikawa-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('100m_mesh_pop2020_toyama-fill', 'visibility', 'visible');
                // legend.style.display = 'block';
            } else {
                // チェックボックスがOFF - レイヤーと凡例を非表示
                afterMap.setLayoutProperty('100m_mesh_pop2020_ishikawa-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('100m_mesh_pop2020_toyama-fill', 'visibility', 'none');
                // legend.style.display = 'none';
            }
        });

        // 石川県孤立集落人数の表示・非表示切り替え制御
        document.getElementById('isolated-map').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('Number_of_isolated_area-fill', 'visibility', 'visible');
                afterMap.setLayoutProperty('Number_of_isolated_area-line', 'visibility', 'visible');
                afterMap.setLayoutProperty('Number_of_isolated_area_centroid-label', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('Number_of_isolated_area-fill', 'visibility', 'none');
                afterMap.setLayoutProperty('Number_of_isolated_area-line', 'visibility', 'none');
                afterMap.setLayoutProperty('Number_of_isolated_area_centroid-label', 'visibility', 'none');
            }
        });

        // 石川県七尾市避難所開設情報の表示・非表示切り替え制御
        document.getElementById('shelter-nanao-map').addEventListener('change', function (e) {
            if (e.target.checked) {
                // チェックボックスがON - レイヤーを表示
                afterMap.setLayoutProperty('open_shelter_Nanao-shi-symbol', 'visibility', 'visible');
                afterMap.setLayoutProperty('open_shelter_Nanao-shi-label', 'visibility', 'visible');
            } else {
                // チェックボックスがOFF - レイヤーを非表示
                afterMap.setLayoutProperty('open_shelter_Nanao-shi-symbol', 'visibility', 'none');
                afterMap.setLayoutProperty('open_shelter_Nanao-shi-label', 'visibility', 'none');
            }
        });

        // ============================== 凡例の表示 ==============================

        // 国土交通省 道路復旧見える化マップ凡例

        // イベントリスナーを追加
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('open-legend-road').addEventListener('click', OpenLegendRoad);
        });

        function OpenLegendRoad() {
            // 凡例の内容を含むウェブページのURL
            var legendUrl = 'https://shiwaku.github.io/noto-peninsula-earthquake-2024-gsi-ortho-map-on-maplibre/data/mlit/img/usage_guide.png';

            // 新しいウィンドウを開く
            window.open(legendUrl, 'Legend', 'width=900,height=600');
        }

        // 簡易100mメッシュ人口凡例

        // イベントリスナーを追加
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('open-legend-pop').addEventListener('click', OpenLegendPop);
        });

        function OpenLegendPop() {
            var legendPop = document.getElementById('legend-pop');
            if (legendPop.style.display === 'none') {
                legendPop.style.display = 'block';
            } else {
                legendPop.style.display = 'none';
            }
        }

        // ============================== ポップアップ表示 ==============================

        // 簡易100mメッシュ人口（石川県）ポップアップ表示
        afterMap.on('click', '100m_mesh_pop2020_ishikawa-fill', (e) => {
            var coordinates = e.features[0].geometry.coordinates[0]; // ポリゴンの頂点の配列
            var lngSum = 0,
                latSum = 0;

            coordinates.forEach((coord) => {
                lngSum += coord[0]; // 経度の合計
                latSum += coord[1]; // 緯度の合計
            });

            var lng = lngSum / coordinates.length; // 経度の平均
            var lat = latSum / coordinates.length; // 緯度の平均

            var MESH_CODE = e.features[0].properties['MESH_CODE'];
            var Shicode = e.features[0].properties['Shicode'];
            var PopT = e.features[0].properties['PopT'];
            var Pop0_14 = e.features[0].properties['Pop0_14'];
            var Pop15_64 = e.features[0].properties['Pop15_64'];
            var Pop65over = e.features[0].properties['Pop65over'];
            var Pop75over = e.features[0].properties['Pop75over'];
            var Pop85over = e.features[0].properties['Pop85over'];

            new maplibregl.Popup({ className: 'custom-100m-mesh-pop2020-popup' })
                .setLngLat(e.lngLat)
                .setHTML(
                    '<div style="solid #000; font-size: 1.2em; color: #0065CB;"><strong>簡易100mメッシュ人口</strong></div>' +
                    '<table class="pop-info">' +
                    '<tr>' +
                    '<th></th>' +
                    '<th></th>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>メッシュコード：</td>' +
                    '<td><b>' +
                    MESH_CODE +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>市区町村コード：</td>' +
                    '<td><b>' +
                    Shicode +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>総人口：</td>' +
                    '<td><b>' +
                    PopT +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>0～14歳人口：</td>' +
                    '<td><b>' +
                    Pop0_14 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>15～64歳人口：</td>' +
                    '<td><b>' +
                    Pop15_64 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>65歳以上人口：</td>' +
                    '<td><b>' +
                    Pop65over +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>75歳以上人口：</td>' +
                    '<td><b>' +
                    Pop75over +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>85歳以上人口：</td>' +
                    '<td><b>' +
                    Pop85over +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '</table>' +
                    '※このデータは、簡易な方法で人口を按分したものであり、当該100mメッシュの実際の人口を示しているものではありません。' +
                    '<br>' +
                    '<a href=\https://www.google.com/maps?q=' +
                    lat +
                    ',' +
                    lng +
                    "&hl=ja' target='_blank'>🌎Google Maps</a>" +
                    ' ' +
                    '<a href=\https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' +
                    lat +
                    ',' +
                    lng +
                    "&hl=ja' target='_blank'>📷Street View</a>"
                )
                .addTo(afterMap);
        });

        // 簡易100mメッシュ人口（富山県）ポップアップ表示
        afterMap.on('click', '100m_mesh_pop2020_toyama-fill', (e) => {
            var coordinates = e.features[0].geometry.coordinates[0]; // ポリゴンの頂点の配列
            var lngSum = 0,
                latSum = 0;

            coordinates.forEach((coord) => {
                lngSum += coord[0]; // 経度の合計
                latSum += coord[1]; // 緯度の合計
            });

            var lng = lngSum / coordinates.length; // 経度の平均
            var lat = latSum / coordinates.length; // 緯度の平均

            var MESH_CODE = e.features[0].properties['MESH_CODE'];
            var Shicode = e.features[0].properties['Shicode'];
            var PopT = e.features[0].properties['PopT'];
            var Pop0_14 = e.features[0].properties['Pop0_14'];
            var Pop15_64 = e.features[0].properties['Pop15_64'];
            var Pop65over = e.features[0].properties['Pop65over'];
            var Pop75over = e.features[0].properties['Pop75over'];
            var Pop85over = e.features[0].properties['Pop85over'];

            new maplibregl.Popup({ className: 'custom-100m-mesh-pop2020-popup' })
                .setLngLat(e.lngLat)
                .setHTML(
                    '<div style="solid #000; font-size: 1.2em; color: #0065CB;"><strong>簡易100mメッシュ人口</strong></div>' +
                    '<table class="pop-info">' +
                    '<tr>' +
                    '<th></th>' +
                    '<th></th>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>メッシュコード：</td>' +
                    '<td><b>' +
                    MESH_CODE +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>市区町村コード：</td>' +
                    '<td><b>' +
                    Shicode +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>総人口：</td>' +
                    '<td><b>' +
                    PopT +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>0～14歳人口：</td>' +
                    '<td><b>' +
                    Pop0_14 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>15～64歳人口：</td>' +
                    '<td><b>' +
                    Pop15_64 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>65歳以上人口：</td>' +
                    '<td><b>' +
                    Pop65over +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>75歳以上人口：</td>' +
                    '<td><b>' +
                    Pop75over +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>85歳以上人口：</td>' +
                    '<td><b>' +
                    Pop85over +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '</table>' +
                    '※このデータは、簡易な方法で人口を按分したものであり、当該100mメッシュの実際の人口を示しているものではありません。' +
                    '<br>' +
                    '<a href=\https://www.google.com/maps?q=' +
                    lat +
                    ',' +
                    lng +
                    "&hl=ja' target='_blank'>🌎Google Maps</a>" +
                    ' ' +
                    '<a href=\https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' +
                    lat +
                    ',' +
                    lng +
                    "&hl=ja' target='_blank'>📷Street View</a>"
                )
                .addTo(afterMap);
        });

        // 石川県孤立集落人数ポップアップ表示
        afterMap.on('click', 'Number_of_isolated_area-fill', (e) => {
            var cityname = e.features[0].properties['自治体'];
            var syuurakuname = e.features[0].properties['孤立集落名'];
            var yomigana = e.features[0].properties['ヨミガナ'];
            var number_0107 = e.features[0].properties['人数_1/7_15時現在'];
            var number_0108 = e.features[0].properties['人数_1/8_15時現在'];
            var number_0109 = e.features[0].properties['人数_1/9_15時現在'];
            var number_0110 = e.features[0].properties['人数_1/10_15時現在'];
            var number_0111 = e.features[0].properties['人数_1/11_15時現在'];
            var number_0112 = e.features[0].properties['人数_1/12_15時現在'];
            var number_0113 = e.features[0].properties['人数_1/13_15時現在'];
            var number_0114 = e.features[0].properties['人数_1/14_15時現在'];
            var number_0115 = e.features[0].properties['人数_1/15_15時現在'];
            var number_0116 = e.features[0].properties['人数_1/16_15時現在'];
            var number_0117 = e.features[0].properties['人数_1/17_15時現在'];
            var number_0118 = e.features[0].properties['人数_1/18_15時現在'];
            var number_0119 = e.features[0].properties['人数_1/19_15時現在'];
            var number_0121 = e.features[0].properties['人数_1/21_15時現在'];

            if (number_0107 === undefined) {
                number_0107 = '-';
            }
            if (number_0108 === undefined) {
                number_0108 = '-';
            }
            if (number_0109 === undefined) {
                number_0109 = '-';
            }
            if (number_0110 === undefined) {
                number_0110 = '-';
            }
            if (number_0111 === undefined) {
                number_0111 = '-';
            }
            if (number_0112 === undefined) {
                number_0112 = '-';
            }
            if (number_0113 === undefined) {
                number_0113 = '-';
            }
            if (number_0114 === undefined) {
                number_0114 = '-';
            }
            if (number_0115 === undefined) {
                number_0115 = '-';
            }
            if (number_0116 === undefined) {
                number_0116 = '-';
            }
            if (number_0117 === undefined) {
                number_0117 = '-';
            }
            if (number_0118 === undefined) {
                number_0118 = '-';
            }
            if (number_0119 === undefined) {
                number_0119 = '-';
            }
            if (number_0121 === undefined) {
                number_0121 = '-';
            }

            new maplibregl.Popup({
                className: 'custom-Number-of-isolated-area-popup',
            })
                .setLngLat(e.lngLat)
                .setHTML(
                    '<div style="solid #000; font-size: 1.2em; color: #CB0065;"><strong>石川県孤立集落人数</strong></div>' +
                    '<table class="pop-info">' +
                    '<tr>' +
                    '<th></th>' +
                    '<th></th>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>自治体：</td>' +
                    '<td><b>' +
                    cityname +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落名：</td>' +
                    '<td><b>' +
                    syuurakuname +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>読み仮名：</td>' +
                    '<td><b>' +
                    yomigana +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/7_15時現在)：</td>' +
                    '<td><b>' +
                    number_0107 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/8_15時現在)：</td>' +
                    '<td><b>' +
                    number_0108 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/9_15時現在)：<br></td>' +
                    '<td><b>' +
                    number_0109 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/10_15時現在)：<br></td>' +
                    '<td><b>' +
                    number_0110 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/11_15時現在)：<br></td>' +
                    '<td><b>' +
                    number_0111 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/12_15時現在)：</td>' +
                    '<td><b>' +
                    number_0112 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/13_15時現在)：</td>' +
                    '<td><b>' +
                    number_0113 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/14_15時現在)：</td>' +
                    '<td><b>' +
                    number_0114 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/15_15時現在)：</td>' +
                    '<td><b>' +
                    number_0115 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/16_15時現在)：</td>' +
                    '<td><b>' +
                    number_0116 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/17_15時現在)：</td>' +
                    '<td><b>' +
                    number_0117 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/18_15時現在)：</td>' +
                    '<td><b>' +
                    number_0118 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/19_15時現在)：</td>' +
                    '<td><b>' +
                    number_0119 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>孤立集落人数(1/21_15時現在)：</td>' +
                    '<td><b>' +
                    number_0121 +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '</table>' +
                    '出典）' +
                    '<a href="https://www.pref.ishikawa.lg.jp/saigai/202401jishin-taisakuhonbu.html#honbu">石川県 災害対策本部員会議資料</a>'
                )
                .addTo(afterMap);
        });

        // 石川県七尾市避難所開設情報ポップアップ表示
        afterMap.on('click', 'open_shelter_Nanao-shi-symbol', (e) => {
            var chiku = e.features[0].properties['地区'];
            var name = e.features[0].properties['名称'];
            var number = e.features[0].properties['人数'];
            var time = e.features[0].properties['時点'];
            var address = e.features[0].properties['所在地_連結表記'];
            var lat = e.features[0].properties['緯度'];
            var lng = e.features[0].properties['経度'];
            var elevation = e.features[0].properties['標高'];
            var tel = e.features[0].properties['電話番号'];
            var capacity = e.features[0].properties['想定収容人数'];
            var target_town_council = e.features[0].properties['対象となる町会・自治会'];

            /*
        var SyubetuIds = ["災害種別_洪水", "災害種別_崖崩れ、土石流及び地滑り", "災害種別_高潮", "災害種別_地震", "災害種別_津波", "災害種別_大規模な火事", "災害種別_内水氾濫", "災害種別_火山現象"];
        var SyubetuMei = ''
        for (var j = 0; j < SyubetuIds.length; j++) {
            if (e.features[0].properties[SyubetuIds[j]] === 1) {
                SyubetuMei += SyubetuIds[j] + "　"
            }
        }
        */
            if (chiku === undefined) {
                chiku = '-';
            }
            if (name === undefined) {
                name = '-';
            }
            if (number === undefined) {
                number = '-';
            }
            if (time === undefined) {
                time = '-';
            }
            if (address === undefined) {
                address = '-';
            }
            if (elevation === undefined) {
                elevation = '-';
            }
            if (tel === undefined) {
                tel = '-';
            }
            if (capacity === undefined) {
                capacity = '-';
            }
            if (target_town_council === undefined) {
                target_town_council = '-';
            }

            new maplibregl.Popup({ className: 'custom-open-shelter-Nanao-popup' })
                .setLngLat(e.lngLat)
                .setHTML(
                    /*
                '<div style="solid #000; font-size: 1.2em; color: #017356;"><strong>七尾市避難所開設情報</strong></div>' +
                */
                    '<div style="solid #000; font-size: 1.2em; color: #017356;"><strong>' +
                    '<a href=https://www.city.nanao.lg.jp/bosai/mail/202401021200.html>' +
                    '石川県七尾市避難所開設情報' +
                    '</a>' +
                    '</strong></div>' +
                    '<table class="pop-info">' +
                    '<tr>' +
                    '<th></th>' +
                    '<th></th>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>地区：</td>' +
                    '<td><b>' +
                    chiku +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>名称：</td>' +
                    '<td><b>' +
                    name +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>人数：</td>' +
                    '<td><b>' +
                    number +
                    '人' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>時点：</td>' +
                    '<td><b>' +
                    time +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>所在地：</td>' +
                    '<td><b>' +
                    address +
                    '</b></td>' +
                    '</tr>' +
                    /*
            '<tr>' +
            '<td>緯度・経度：</td>' +
            '<td><b>' + lat + ',' + lng + '</b></td>' +
            '</tr>' +
            */
                    '<tr>' +
                    '<td>標高：</td>' +
                    '<td><b>' +
                    elevation +
                    'm' +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>電話番号：</td>' +
                    '<td><b>' +
                    tel +
                    '</b></td>' +
                    '</tr>' +
                    /*
            '<tr>' +
            '<td>対応している：<br>災害の種別</td>' +
            '<td><b>' + SyubetuMei + '</b></td>' +
            '</tr>' +
            */
                    '<tr>' +
                    '<td>想定収容人数：</td>' +
                    '<td><b>' +
                    capacity +
                    '</b></td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td>対象となる町会・自治会：</td>' +
                    '<td><b>' +
                    target_town_council +
                    '</b></td>' +
                    '</tr>' +
                    '</table>' +
                    '<b>' +
                    '※最新かつ詳細の状況などは必ず当該市町村にご確認ください。' +
                    '</b>' +
                    '<br>' +
                    '<a href=\https://www.google.com/maps?q=' +
                    lat +
                    ',' +
                    lng +
                    "&hl=ja' target='_blank'>🌎Google Maps</a>"
                )
                .addTo(afterMap);
        });

        // 啓開前・啓開後比較箇所ポップアップ表示
        afterMap.on('click', 'before_after-symbol', async (e) => {
            var lng = e.features[0].geometry.coordinates[0];
            var lat = e.features[0].geometry.coordinates[1];
            var name = e.features[0].properties['name'];

            var baseUrl = 'https://www.mlit.go.jp/road/r6noto/map';

            var beforeValue = e.features[0].properties['啓開前'];
            var beforefilename = beforeValue.match(/src=\"\.\/img\/before_after\/(.*?)\"/)[1];
            var imageBeforeUrl = baseUrl + '/img/before_after/' + beforefilename;

            var startValue = e.features[0].properties['啓開作業'];
            var startfilename,
                imageStartUrl,
                startHtml = '';

            if (startValue && startValue !== '') {
                startfilename = startValue.match(/src=\"\.\/img\/before_after\/(.*?)\"/)[1];
                imageStartUrl = baseUrl + '/img/before_after/' + startfilename;
                startHtml = '啓開作業：' + '<br>' + '<div><a href="' + imageStartUrl + '" target="_blank"><img class="popup-image" src="' + imageStartUrl + '" alt="画像"></a></div>';
            }

            var afterValue = e.features[0].properties['啓開後'];
            var afterfilename,
                imageAfterUrl,
                afterHtml = '';
            if (afterValue && afterValue !== '') {
                afterfilename = afterValue.match(/src=\"\.\/img\/before_after\/(.*?)\"/)[1];
                imageAfterUrl = baseUrl + '/img/before_after/' + afterfilename;
                afterHtml = '啓開後：' + '<br>' + '<div><a href="' + imageAfterUrl + '" target="_blank"><img class="popup-image" src="' + imageAfterUrl + '" alt="画像"></a></div>';
            }

            new maplibregl.Popup({ className: 'custom-before-after-popup' })
                .setLngLat(e.lngLat)
                .setHTML(
                    '<div style="border-bottom:1px solid #000;"><strong>啓開前・啓開後比較箇所</strong></div>' +
                    '<div><strong>' +
                    name +
                    '</strong></div>' +
                    '啓開前：' +
                    '<br>' +
                    '<div><a href="' +
                    imageBeforeUrl +
                    '" target="_blank"><img class="popup-image" src="' +
                    imageBeforeUrl +
                    '" alt="画像"></a></div>' +
                    startHtml + // 啓開作業のHTML
                    afterHtml + // 啓開後のHTML
                    '<div><a href="https://www.google.com/maps?q=' +
                    lat +
                    ',' +
                    lng +
                    '&hl=ja" target="_blank">🌎Google Maps</a></div>' +
                    '<div><a href="https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' +
                    lat +
                    ',' +
                    lng +
                    '&hl=ja" target="_blank">📷Street View</a></div>'
                )
                .addTo(afterMap);
        });

        // 啓開作業状況ポップアップ表示
        afterMap.on('click', 'sagyou-symbol', async (e) => {
            var lng = e.features[0].geometry.coordinates[0];
            var lat = e.features[0].geometry.coordinates[1];
            var name = e.features[0].properties['name'];
            var photo_date = e.features[0].properties['撮影日'];

            if (photo_date === undefined) {
                photo_date = '-';
            }

            // ポップアップ用のHTMLコンテンツを生成する関数
            function generateContentHtml(propertyValue) {
                var parser = new DOMParser();
                var doc = parser.parseFromString(propertyValue, 'text/html');
                var contentHtml = '';

                if (doc.querySelector('iframe')) {
                    var iframeSrc = doc.querySelector('iframe').src;
                    contentHtml = '<iframe src="' + iframeSrc + '" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>';
                } else {
                    var images = doc.querySelectorAll('img');
                    var baseUrl = 'https://www.mlit.go.jp/road/r6noto/map/';
                    images.forEach((img) => {
                        var relativeSrc = img.getAttribute('src');
                        if (relativeSrc.startsWith('./')) {
                            relativeSrc = relativeSrc.substring(2);
                        }
                        var imgSrc = baseUrl + relativeSrc;
                        contentHtml += '<a href="' + imgSrc + '" target="_blank"><img src="' + imgSrc + '" alt="画像" style="max-width:100%;height:auto;"></a>';
                    });
                }
                return contentHtml;
            }

            // プロパティと見出しのマッピング
            var propertiesWithHeaders = {
                啓開前: '啓開前：',
                啓開作業等: '啓開作業等：',
                啓開後: '啓開後：',
                緊急車両の通行状況: '緊急車両の通行状況：',
                被災状況: '被災状況：',
            };
            var popupContent = '';

            // 各プロパティに対してHTMLコンテンツを生成
            Object.keys(propertiesWithHeaders).forEach((prop) => {
                if (e.features[0].properties[prop]) {
                    popupContent += '<div>' + propertiesWithHeaders[prop] + '</div>';
                    popupContent += generateContentHtml(e.features[0].properties[prop]);
                }
            });

            // ポップアップの表示
            new maplibregl.Popup({ className: 'custom-sagyou-popup' })
                .setLngLat(e.lngLat)
                .setHTML('<div style="border-bottom:1px solid #000;"><strong>啓開作業状況</strong></div>' + '<div><strong>' + name + '</strong></div>' + '<div>撮影日：' + photo_date + '</div>' + popupContent + '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>' + '<div><a href="https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' + lat + ',' + lng + '&hl=ja" target="_blank">📷Street View</a></div>')
                .addTo(afterMap);
        });

        // 主な被災箇所ポップアップ表示
        afterMap.on('click', 'damaged_area-symbol', async (e) => {
            var lng = e.features[0].geometry.coordinates[0];
            var lat = e.features[0].geometry.coordinates[1];
            var name = e.features[0].properties['name'];
            var rosen = e.features[0].properties['路線名'];
            var damaged = e.features[0].properties['被災規模'];
            var chimei = e.features[0].properties['地名（推定）'];

            if (damaged === '大' || damaged === '小～中') {
                new maplibregl.Popup({ className: 'custom-damaged-area-popup' })
                    .setLngLat(e.lngLat)
                    .setHTML('<div style="border-bottom:1px solid #000;"><strong>主な被災箇所</strong></div>' + '<div><strong>' + name + '</strong></div>' + '路線名：' + rosen + '<br>' + '被災規模：' + damaged + '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>' + '<div><a href="https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' + lat + ',' + lng + '&hl=ja" target="_blank">📷Street View</a></div>')
                    .addTo(afterMap);
            } else if (damaged === undefined) {
                new maplibregl.Popup({ className: 'custom-damaged-area-popup' })
                    .setLngLat(e.lngLat)
                    .setHTML('<div style="border-bottom:1px solid #000;"><strong>主な被災箇所</strong></div>' + '<div><strong>' + name + '</strong></div>' + '路線名：' + rosen + '<br>' + '地名（推定）：' + chimei + '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>' + '<div><a href="https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' + lat + ',' + lng + '&hl=ja" target="_blank">📷Street View</a></div>')
                    .addTo(afterMap);
            }
        });

        /*
    // 被災状況（空撮）ポップアップ表示
    afterMap.on('click', 'damage_situation_aerial_photography-symbol', async (e) => {
        var lng = e.features[0].geometry.coordinates[0];
        var lat = e.features[0].geometry.coordinates[1];
        var name = e.features[0].properties['name'];
        var view = e.features[0].properties['view'];

        // ベースURL
        var baseUrl = "https://www.mlit.go.jp/road/r6noto/map/img/kuusatsu/";
        var imageUrl = baseUrl + name + '.jpg'

        new maplibregl.Popup({ className: 'custom-damage-situation-aerial-photography-popup' })
            .setLngLat(e.lngLat)
            .setHTML(
                '<div style="border-bottom:1px solid #000;"><strong>name:' + name + '</strong></div>' +
                '被災状況(空撮)：' + '<br>' +
                '<div><a href="' + imageUrl + '" target="_blank"><img class="popup-image" src="' + imageUrl + '" alt="画像"></a></div>' +
                '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>'
            )
            .addTo(afterMap);
    });
    */

        // 復旧到達地点ポップアップ表示
        afterMap.on('click', 'recovery_point-symbol', async (e) => {
            var lng = e.features[0].geometry.coordinates[0];
            var lat = e.features[0].geometry.coordinates[1];
            var name = e.features[0].properties['name'];

            new maplibregl.Popup({ className: 'custom-recovery-point-popup' })
                .setLngLat(e.lngLat)
                .setHTML('<div style="border-bottom:1px solid #000;"><strong>復旧到達地点</strong></div>' + '<div><strong>' + name + '</strong></div>' + '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>' + '<div><a href="https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' + lat + ',' + lng + '&hl=ja" target="_blank">📷Street View</a></div>')
                .addTo(afterMap);
        });

        /*
    // 緊急復旧済み区間ポップアップ表示
    afterMap.on('click', 'emergency_restored_section-line', async (e) => {
        var lng = e.features[0].geometry.coordinates[0];
        var lat = e.features[0].geometry.coordinates[1];
        var name = e.features[0].properties['name'];
        var length = e.features[0].properties['総延長'];
        var source = e.features[0].properties['データ出典'];

        new maplibregl.Popup({ className: 'custom-emergency-restored-section-popup' })
            .setLngLat(e.lngLat)
            .setHTML(
                '<div style="border-bottom:1px solid #000;"><strong>name:' + name + '</strong></div>' +
                '総延長：' + length + '<br>' +
                'データ出典：' + source +
                '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>' +
                '<div><a href="https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' + lat + ',' + lng + '&hl=ja" target="_blank">📷Street View</a></div>'
            )
            .addTo(afterMap);
    });
    */

        // 支援拠点の道の駅ポップアップ表示
        afterMap.on('click', 'michinoeki-symbol', async (e) => {
            var lng = e.features[0].geometry.coordinates[0];
            var lat = e.features[0].geometry.coordinates[1];
            var name = e.features[0].properties['name'];

            // ベースURL
            var baseUrl = 'https://www.mlit.go.jp/road/r6noto/map';

            // '道の駅の状況'の値から全ての画像ファイル名を抽出
            var photoValues = e.features[0].properties['道の駅の状況'];
            var photoFilenames = [...photoValues.matchAll(/src=\"\.\/img\/michinoeki\/(.*?)\"/g)].map((match) => match[1]);

            // 画像URLのHTMLを生成
            var imagesHtml = photoFilenames.map((filename) => '<div><a href="' + baseUrl + '/img/michinoeki/' + filename + '" target="_blank">' + '<img class="popup-image" src="' + baseUrl + '/img/michinoeki/' + filename + '" alt="画像"></a></div>').join('');

            // 画像タグを除いた純粋なテキスト内容を抽出
            var statusText = photoValues.replace(/<img.*?>/g, '');

            new maplibregl.Popup({ className: 'custom-michinoeki-popup' })
                .setLngLat(e.lngLat)
                .setHTML('<div style="border-bottom:1px solid #000;"><strong>道の駅の状況</strong></div>' + '<div><strong>' + name + '</strong></div>' + '<div>道の駅の状況：' + statusText + '</div>' + '現地写真：' + '<br>' + imagesHtml + '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>' + '<div><a href="https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=' + lat + ',' + lng + '&hl=ja" target="_blank">📷Street View</a></div>')
                .addTo(afterMap);
        });

        // 市町道路の状況把握結果ポップアップ表示
        afterMap.on('click', 'municipal_road_investigation-symbol', async (e) => {
            var lng = e.features[0].geometry.coordinates[0];
            var lat = e.features[0].geometry.coordinates[1];
            var name = e.features[0].properties['name'];
            var chikumei = e.features[0].properties['地区名'];
            var chousahan = e.features[0].properties['現地調査班'];
            var pdfurl = e.features[0].properties['調査結果'];

            new maplibregl.Popup({ className: 'custom-municipal-road-investigation-popup' })
                .setLngLat(e.lngLat)
                .setHTML('<div style="border-bottom:1px solid #000;"><strong>' + name + '</strong></div>' + '<div>地区名：' + chikumei + '</div>' + '<div>現地調査班：' + chousahan + '</div>' + '<div>調査結果：' + pdfurl + '</div>' + '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>')
                .addTo(afterMap);
        });

        // 被災状況（360度画像/三次元点群データ）ポップアップ表示
        afterMap.on('click', 'spherical_image-symbol', async (e) => {
            var lng = e.features[0].geometry.coordinates[0];
            var lat = e.features[0].geometry.coordinates[1];
            var name = e.features[0].properties['name'];
            var linkurl = e.features[0].properties['リンク'];

            new maplibregl.Popup({ className: 'custom-spherical-image-popup' })
                .setLngLat(e.lngLat)
                .setHTML('<div style="border-bottom:1px solid #000;"><strong>' + name + '</strong></div>' + '<div>リンク：' + linkurl + '</div>' + '<div><a href="https://www.google.com/maps?q=' + lat + ',' + lng + '&hl=ja" target="_blank">🌎Google Maps</a></div>')
                .addTo(afterMap);
        });
    </script>
</body>

</html>